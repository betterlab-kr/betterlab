<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í˜ì´ì§€ í…ìŠ¤íŠ¸ í¸ì§‘ - ë”ë‚˜ì€ê¸°ì—…ì—°êµ¬ì†Œ</title>
  <link rel="stylesheet" href="/css/dashboard.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
  <script src="/js/admin-auth.js"></script>
  <style>
    .page-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    .page-tab {
      padding: 10px 20px;
      border: 1px solid var(--neutral-200);
      border-radius: 8px;
      background: white;
      color: var(--neutral-600);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .page-tab:hover {
      border-color: var(--primary);
      color: var(--primary);
    }
    .page-tab.active {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }
    .editable-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .editable-item {
      background: white;
      border: 1px solid var(--neutral-200);
      border-radius: 12px;
      padding: 20px;
      transition: all 0.2s;
    }
    .editable-item:hover {
      border-color: var(--primary-light);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    .editable-item.modified {
      border-color: var(--warning);
      background: rgba(245, 158, 11, 0.05);
    }
    .editable-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .editable-id {
      font-size: 12px;
      font-family: monospace;
      color: var(--neutral-500);
      background: var(--neutral-100);
      padding: 4px 8px;
      border-radius: 4px;
    }
    .editable-tag {
      font-size: 11px;
      color: var(--neutral-400);
      text-transform: uppercase;
    }
    .editable-input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--neutral-200);
      border-radius: 8px;
      font-size: 15px;
      line-height: 1.5;
      resize: vertical;
      min-height: 60px;
      font-family: inherit;
      transition: all 0.2s;
    }
    .editable-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    .editable-input.modified {
      border-color: var(--warning);
    }
    .editable-original {
      margin-top: 8px;
      font-size: 12px;
      color: var(--neutral-500);
    }
    .editable-original span {
      color: var(--neutral-400);
    }
    .save-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid var(--neutral-200);
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(100%);
      transition: transform 0.3s ease;
      z-index: 1000;
    }
    .save-bar.visible {
      transform: translateY(0);
    }
    .save-bar .changes-info {
      font-size: 14px;
      color: var(--neutral-600);
    }
    .save-bar .changes-count {
      font-weight: 600;
      color: var(--warning);
    }
    .save-bar .actions {
      display: flex;
      gap: 12px;
    }
    .btn-reset {
      padding: 10px 20px;
      border: 1px solid var(--neutral-300);
      background: white;
      color: var(--neutral-600);
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-reset:hover {
      background: var(--neutral-50);
    }
    .btn-save {
      padding: 10px 24px;
      border: none;
      background: var(--primary);
      color: white;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-save:hover {
      background: var(--primary-dark);
    }
    .btn-save:disabled {
      background: var(--neutral-300);
      cursor: not-allowed;
    }
    .loading-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px;
      color: var(--neutral-500);
    }
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--neutral-200);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .empty-state {
      text-align: center;
      padding: 60px;
      color: var(--neutral-500);
    }
    .empty-state svg {
      width: 64px;
      height: 64px;
      color: var(--neutral-300);
      margin-bottom: 16px;
    }
    .search-box {
      margin-bottom: 20px;
    }
    .search-input {
      width: 100%;
      max-width: 400px;
      padding: 12px 16px 12px 44px;
      border: 1px solid var(--neutral-200);
      border-radius: 8px;
      font-size: 14px;
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%239CA3AF' stroke-width='2'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cpath d='M21 21l-4.35-4.35'/%3E%3C/svg%3E") no-repeat 14px center;
      background-size: 18px;
    }
    .search-input:focus {
      outline: none;
      border-color: var(--primary);
    }
    .success-toast {
      position: fixed;
      top: 24px;
      right: 24px;
      background: #10B981;
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transform: translateX(calc(100% + 24px));
      transition: transform 0.3s ease;
      z-index: 1001;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .success-toast.visible {
      transform: translateX(0);
    }
    .content-wrapper {
      padding-bottom: 100px;
    }
    /* ì„¹ì…˜ ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
    .section-group {
      margin-bottom: 16px;
      border: 1px solid var(--neutral-200);
      border-radius: 12px;
      overflow: hidden;
      background: white;
    }
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      background: var(--neutral-50);
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
    }
    .section-header:hover {
      background: var(--neutral-100);
    }
    .section-header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .section-icon {
      font-size: 18px;
    }
    .section-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--neutral-800);
    }
    .section-count {
      font-size: 12px;
      color: var(--neutral-500);
      background: var(--neutral-200);
      padding: 2px 8px;
      border-radius: 10px;
      margin-left: 8px;
    }
    .section-toggle {
      transition: transform 0.2s;
    }
    .section-group.collapsed .section-toggle {
      transform: rotate(-90deg);
    }
    .section-content {
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 16px;
      border-top: 1px solid var(--neutral-200);
    }
    .section-group.collapsed .section-content {
      display: none;
    }
    .section-content .editable-item {
      margin: 0;
      border-radius: 8px;
    }
    .info-box {
      background: linear-gradient(135deg, #EFF6FF 0%, #DBEAFE 100%);
      border: 1px solid #BFDBFE;
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 24px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }
    .info-box svg {
      flex-shrink: 0;
      color: #3B82F6;
    }
    .info-box p {
      font-size: 14px;
      color: #1E40AF;
      line-height: 1.5;
      margin: 0;
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <!-- ì‚¬ì´ë“œë°” -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1 class="logo">BETTER LAB</h1>
        <span class="logo-sub">ê´€ë¦¬ì</span>
      </div>

      <nav class="sidebar-nav">
        <a href="/admin/" class="nav-item">
          <span class="nav-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7"/>
              <rect x="14" y="3" width="7" height="7"/>
              <rect x="14" y="14" width="7" height="7"/>
              <rect x="3" y="14" width="7" height="7"/>
            </svg>
          </span>
          <span class="nav-text">ëŒ€ì‹œë³´ë“œ</span>
        </a>
        <a href="/admin/leads.html" class="nav-item">
          <span class="nav-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/>
              <path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/>
            </svg>
          </span>
          <span class="nav-text">ì ‘ìˆ˜ë‚´ì—­</span>
        </a>
        <a href="/admin/board.html" class="nav-item">
          <span class="nav-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
          </span>
          <span class="nav-text">ê²Œì‹œíŒ ê´€ë¦¬</span>
        </a>
        <a href="/admin/employees.html" class="nav-item">
          <span class="nav-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
          </span>
          <span class="nav-text">ì„ì§ì› ê´€ë¦¬</span>
        </a>
        <a href="/admin/popups.html" class="nav-item">
          <span class="nav-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <circle cx="8.5" cy="8.5" r="1.5"/>
              <polyline points="21 15 16 10 5 21"/>
            </svg>
          </span>
          <span class="nav-text">íŒì—… ê´€ë¦¬</span>
        </a>
        <a href="/admin/analytics.html" class="nav-item">
          <span class="nav-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="20" x2="18" y2="10"/>
              <line x1="12" y1="20" x2="12" y2="4"/>
              <line x1="6" y1="20" x2="6" y2="14"/>
            </svg>
          </span>
          <span class="nav-text">ë°©ë¬¸í†µê³„</span>
        </a>
        <a href="/admin/pages.html" class="nav-item active">
          <span class="nav-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
          </span>
          <span class="nav-text">í˜ì´ì§€ í¸ì§‘</span>
        </a>
        <a href="/admin/settings.html" class="nav-item">
          <span class="nav-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"/>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
            </svg>
          </span>
          <span class="nav-text">ì„¤ì •</span>
        </a>
      </nav>
    </aside>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
      <header class="content-header">
        <div>
          <h1>í˜ì´ì§€ í…ìŠ¤íŠ¸ í¸ì§‘</h1>
          <p class="text-muted">í™ˆí˜ì´ì§€ì˜ í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
        </div>
      </header>

      <div class="content-wrapper">
        <div class="info-box">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M12 16v-4M12 8h.01"></path>
          </svg>
          <p>í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ì •í•˜ë©´ GitHubì— ìë™ìœ¼ë¡œ ì»¤ë°‹ë©ë‹ˆë‹¤. ë³€ê²½ ì‚¬í•­ì€ ë°°í¬ í›„ ì•½ 1-2ë¶„ ë‚´ì— ë°˜ì˜ë©ë‹ˆë‹¤.</p>
        </div>

        <!-- í˜ì´ì§€ íƒ­ -->
        <div class="page-tabs" id="pageTabs">
          <!-- JavaScriptë¡œ ìƒì„± -->
        </div>

        <!-- ê²€ìƒ‰ -->
        <div class="search-box">
          <input type="text" class="search-input" placeholder="í…ìŠ¤íŠ¸ ID ë˜ëŠ” ë‚´ìš©ìœ¼ë¡œ ê²€ìƒ‰..." id="searchInput">
        </div>

        <!-- í¸ì§‘ ê°€ëŠ¥í•œ í•­ëª© ëª©ë¡ -->
        <div class="editable-list" id="editableList">
          <div class="loading-state">
            <div class="loading-spinner"></div>
            <p>í¸ì§‘ ê°€ëŠ¥í•œ í•­ëª©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
          </div>
        </div>
      </div>

      <!-- ì €ì¥ ë°” -->
      <div class="save-bar" id="saveBar">
        <div class="changes-info">
          <span class="changes-count" id="changesCount">0</span>ê°œ í•­ëª©ì´ ìˆ˜ì •ë¨
        </div>
        <div class="actions">
          <button class="btn-reset" onclick="resetChanges()">ë³€ê²½ ì·¨ì†Œ</button>
          <button class="btn-save" id="saveBtn" onclick="saveChanges()">ì €ì¥í•˜ê¸°</button>
        </div>
      </div>

      <!-- ì„±ê³µ í† ìŠ¤íŠ¸ -->
      <div class="success-toast" id="successToast">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
          <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>
        <span id="toastMessage">ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤</span>
      </div>
    </main>
  </div>

  <script>
    const API_BASE = 'https://kpfc-api.a01027770093.workers.dev';

    // ì„¹ì…˜ ì •ì˜
    const SECTIONS = {
      index: {
        hero: { name: 'íˆì–´ë¡œ ì„¹ì…˜', icon: 'ğŸ¯' },
        process: { name: 'ì§„í–‰ì ˆì°¨ ì„¹ì…˜', icon: 'ğŸ“‹' },
        service: { name: 'ì„œë¹„ìŠ¤ ì„¹ì…˜', icon: 'ğŸ’¼' },
        trust: { name: 'ì‹ ë¢°ì§€í‘œ ì„¹ì…˜', icon: 'ğŸ“Š' },
        board: { name: 'ê²Œì‹œíŒ ì„¹ì…˜', icon: 'ğŸ“°' }
      },
      about: {
        hero: { name: 'íˆì–´ë¡œ ì„¹ì…˜', icon: 'ğŸ¯' },
        system: { name: 'ì‹œìŠ¤í…œ ì„¹ì…˜', icon: 'âš™ï¸' },
        category: { name: 'ì‚¬ì—…ë¶„ì•¼ ì„¹ì…˜', icon: 'ğŸ“' },
        employees: { name: 'ì„ì§ì› ì„¹ì…˜', icon: 'ğŸ‘¥' }
      },
      fund: {
        hero: { name: 'íˆì–´ë¡œ ì„¹ì…˜', icon: 'ğŸ¯' },
        process: { name: 'ì§„í–‰ì ˆì°¨ ì„¹ì…˜', icon: 'ğŸ“‹' },
        detail: { name: 'ìê¸ˆìƒì„¸ ì„¹ì…˜', icon: 'ğŸ’°' },
        success: { name: 'ì„±ê³µì‚¬ë¡€ ì„¹ì…˜', icon: 'ğŸ†' }
      },
      service: {
        hero: { name: 'íˆì–´ë¡œ ì„¹ì…˜', icon: 'ğŸ¯' },
        expert: { name: 'ì „ë¬¸ê°€ ì„¹ì…˜', icon: 'ğŸ‘¨â€ğŸ’¼' }
      },
      process: {
        hero: { name: 'íˆì–´ë¡œ ì„¹ì…˜', icon: 'ğŸ¯' },
        service: { name: 'ì„œë¹„ìŠ¤íŠ¹ì§• ì„¹ì…˜', icon: 'âœ¨' },
        faq: { name: 'FAQ ì„¹ì…˜', icon: 'â“' },
        cta: { name: 'CTA ì„¹ì…˜', icon: 'ğŸ“¢' }
      }
    };

    let pages = [];
    let currentPage = null;
    let editables = [];
    let originalValues = {};
    let changes = {};
    let collapsedSections = {};

    // í˜ì´ì§€ ëª©ë¡ ë¡œë“œ
    async function loadPages() {
      try {
        const res = await fetch(`${API_BASE}/api/pages`);
        const data = await res.json();

        if (data.success) {
          pages = data.pages;
          renderPageTabs();

          // ì²« ë²ˆì§¸ í˜ì´ì§€ ì„ íƒ
          if (pages.length > 0) {
            selectPage(pages[0].id);
          }
        } else {
          showError('í˜ì´ì§€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + data.error);
        }
      } catch (error) {
        showError('API ì—°ê²° ì‹¤íŒ¨: ' + error.message);
      }
    }

    // í˜ì´ì§€ íƒ­ ë Œë”ë§
    function renderPageTabs() {
      const container = document.getElementById('pageTabs');
      container.innerHTML = pages.map(page => `
        <button class="page-tab ${currentPage === page.id ? 'active' : ''}"
                onclick="selectPage('${page.id}')"
                data-page="${page.id}">
          ${page.name}
        </button>
      `).join('');
    }

    // í˜ì´ì§€ ì„ íƒ
    async function selectPage(pageId) {
      currentPage = pageId;
      renderPageTabs();

      // ë³€ê²½ ì‚¬í•­ ì´ˆê¸°í™”
      changes = {};
      updateSaveBar();

      await loadEditables(pageId);
    }

    // í¸ì§‘ ê°€ëŠ¥í•œ í•­ëª© ë¡œë“œ
    async function loadEditables(pageId) {
      const container = document.getElementById('editableList');
      container.innerHTML = `
        <div class="loading-state">
          <div class="loading-spinner"></div>
          <p>í¸ì§‘ ê°€ëŠ¥í•œ í•­ëª©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      `;

      try {
        const res = await fetch(`${API_BASE}/api/pages/${pageId}/editables`);
        const data = await res.json();

        if (data.success) {
          editables = data.editables;
          originalValues = {};

          editables.forEach(item => {
            originalValues[item.id] = item.text;
          });

          renderEditables();
        } else {
          container.innerHTML = `
            <div class="empty-state">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 8v4M12 16h.01"></path>
              </svg>
              <p>${data.error || 'í¸ì§‘ ê°€ëŠ¥í•œ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤'}</p>
            </div>
          `;
        }
      } catch (error) {
        container.innerHTML = `
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>
            </svg>
            <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${error.message}</p>
          </div>
        `;
      }
    }

    // IDì—ì„œ ì„¹ì…˜ ì¶”ì¶œ
    function extractSection(id) {
      const parts = id.split('-');
      if (parts.length >= 2) {
        return parts[1]; // {page}-{section}-{element}
      }
      return 'other';
    }

    // ì„¹ì…˜ë³„ë¡œ ê·¸ë£¹í™”
    function groupBySection(items) {
      const groups = {};
      items.forEach(item => {
        const section = extractSection(item.id);
        if (!groups[section]) {
          groups[section] = [];
        }
        groups[section].push(item);
      });
      return groups;
    }

    // ì„¹ì…˜ í† ê¸€
    function toggleSection(sectionId) {
      const key = `${currentPage}-${sectionId}`;
      // ê¸°ë³¸ê°’ì´ ì ‘íŒ ìƒíƒœ(true)ì´ë¯€ë¡œ, undefinedë©´ ì ‘í˜€ìˆìŒ
      const currentState = collapsedSections[key] !== false;
      collapsedSections[key] = !currentState;
      const group = document.querySelector(`[data-section="${sectionId}"]`);
      if (group) {
        group.classList.toggle('collapsed', collapsedSections[key]);
      }
    }

    // í¸ì§‘ ê°€ëŠ¥í•œ í•­ëª© ë Œë”ë§
    function renderEditables(filter = '') {
      const container = document.getElementById('editableList');
      const filterLower = filter.toLowerCase();

      const filtered = editables.filter(item =>
        !filter ||
        item.id.toLowerCase().includes(filterLower) ||
        item.text.toLowerCase().includes(filterLower)
      );

      if (filtered.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="M21 21l-4.35-4.35"></path>
            </svg>
            <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
          </div>
        `;
        return;
      }

      // ê²€ìƒ‰ í•„í„°ê°€ ìˆìœ¼ë©´ flatìœ¼ë¡œ í‘œì‹œ
      if (filter) {
        container.innerHTML = filtered.map(item => renderEditableItem(item)).join('');
        return;
      }

      // ì„¹ì…˜ë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ í‘œì‹œ
      const grouped = groupBySection(filtered);
      const pageSections = SECTIONS[currentPage] || {};
      const sectionOrder = Object.keys(pageSections);

      // ì •ì˜ëœ ì„¹ì…˜ ìˆœì„œëŒ€ë¡œ + ë‚˜ë¨¸ì§€
      const allSections = [...new Set([...sectionOrder, ...Object.keys(grouped)])];

      container.innerHTML = allSections.map(sectionId => {
        const items = grouped[sectionId];
        if (!items || items.length === 0) return '';

        const sectionInfo = pageSections[sectionId] || { name: sectionId, icon: 'ğŸ“„' };
        const key = `${currentPage}-${sectionId}`;
        // ê¸°ë³¸ê°’ì„ ì ‘íŒ ìƒíƒœ(true)ë¡œ ì„¤ì • - undefined ë˜ëŠ” trueë©´ ì ‘í˜
        const isCollapsed = collapsedSections[key] !== false;

        return `
          <div class="section-group ${isCollapsed ? 'collapsed' : ''}" data-section="${sectionId}">
            <div class="section-header" onclick="toggleSection('${sectionId}')">
              <div class="section-header-left">
                <span class="section-icon">${sectionInfo.icon}</span>
                <span class="section-title">${sectionInfo.name}</span>
                <span class="section-count">${items.length}ê°œ</span>
              </div>
              <svg class="section-toggle" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </div>
            <div class="section-content">
              ${items.map(item => renderEditableItem(item)).join('')}
            </div>
          </div>
        `;
      }).join('');
    }

    // ê°œë³„ í•­ëª© ë Œë”ë§
    function renderEditableItem(item) {
      const isModified = changes[item.id] !== undefined;
      const currentValue = changes[item.id] !== undefined ? changes[item.id] : item.text;

      return `
        <div class="editable-item ${isModified ? 'modified' : ''}" data-id="${item.id}">
          <div class="editable-header">
            <span class="editable-id">${item.id}</span>
            <span class="editable-tag">&lt;${item.tag}&gt;</span>
          </div>
          <textarea class="editable-input ${isModified ? 'modified' : ''}"
                    data-id="${item.id}"
                    oninput="handleInput(this)">${escapeHtml(currentValue)}</textarea>
          ${isModified ? `
            <div class="editable-original">
              <span>ì›ë³¸:</span> ${escapeHtml(item.text)}
            </div>
          ` : ''}
        </div>
      `;
    }

    // ì…ë ¥ í•¸ë“¤ëŸ¬
    function handleInput(textarea) {
      const id = textarea.dataset.id;
      const newValue = textarea.value;
      const originalValue = originalValues[id];

      if (newValue !== originalValue) {
        changes[id] = newValue;
      } else {
        delete changes[id];
      }

      // UI ì—…ë°ì´íŠ¸
      const item = textarea.closest('.editable-item');
      if (changes[id] !== undefined) {
        item.classList.add('modified');
        textarea.classList.add('modified');
      } else {
        item.classList.remove('modified');
        textarea.classList.remove('modified');
      }

      updateSaveBar();
    }

    // ì €ì¥ ë°” ì—…ë°ì´íŠ¸
    function updateSaveBar() {
      const saveBar = document.getElementById('saveBar');
      const changesCount = document.getElementById('changesCount');
      const count = Object.keys(changes).length;

      changesCount.textContent = count;

      if (count > 0) {
        saveBar.classList.add('visible');
      } else {
        saveBar.classList.remove('visible');
      }
    }

    // ë³€ê²½ ì·¨ì†Œ
    function resetChanges() {
      changes = {};
      renderEditables(document.getElementById('searchInput').value);
      updateSaveBar();
    }

    // ì €ì¥
    async function saveChanges() {
      if (Object.keys(changes).length === 0) return;

      const saveBtn = document.getElementById('saveBtn');
      saveBtn.disabled = true;
      saveBtn.textContent = 'ì €ì¥ ì¤‘...';

      try {
        const res = await fetch(`${API_BASE}/api/pages/${currentPage}/update`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ changes })
        });

        const data = await res.json();

        if (data.success) {
          showToast(data.message);

          // ë³€ê²½ ì‚¬í•­ ì ìš©
          Object.entries(changes).forEach(([id, value]) => {
            originalValues[id] = value;
            const item = editables.find(e => e.id === id);
            if (item) item.text = value;
          });

          changes = {};
          renderEditables(document.getElementById('searchInput').value);
          updateSaveBar();
        } else {
          alert('ì €ì¥ ì‹¤íŒ¨: ' + data.error);
        }
      } catch (error) {
        alert('ì €ì¥ ì‹¤íŒ¨: ' + error.message);
      } finally {
        saveBtn.disabled = false;
        saveBtn.textContent = 'ì €ì¥í•˜ê¸°';
      }
    }

    // í† ìŠ¤íŠ¸ í‘œì‹œ
    function showToast(message) {
      const toast = document.getElementById('successToast');
      const toastMessage = document.getElementById('toastMessage');
      toastMessage.textContent = message;
      toast.classList.add('visible');

      setTimeout(() => {
        toast.classList.remove('visible');
      }, 5000);
    }

    // ì—ëŸ¬ í‘œì‹œ
    function showError(message) {
      const container = document.getElementById('editableList');
      container.innerHTML = `
        <div class="empty-state">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>
          </svg>
          <p>${message}</p>
        </div>
      `;
    }

    // HTML ì´ìŠ¤ì¼€ì´í”„
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ê²€ìƒ‰ ì´ë²¤íŠ¸
    document.getElementById('searchInput').addEventListener('input', (e) => {
      renderEditables(e.target.value);
    });

    // ì´ˆê¸°í™”
    loadPages();
  </script>
</body>
</html>
